<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, minimum-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Tip, Pay & Time • App</title>
  <meta name="theme-color" content="#0b1220">
  <style>
body { text-transform: capitalize; }

    :root{
      --bg:#0b1220;
      --surface:#0f172a;
      --panel:#111827;
      --ring:#243244;
      --muted:#9aa5b4;
      --text:#f1f5f9;
      --accent:#22c55e;
      --danger:#ef4444;
      --info:#38bdf8;
      --accent2:#a78bfa;
      --tab:#0f1c33;
      --tabActive:#1a2d4d;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --maxContent: 720px;
    }
    *{box-sizing:border-box;font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;min-width:0}
    html,body{height:100%;background:var(--bg);color:var(--text);overflow-x:hidden}
    body{margin:0;word-wrap:break-word;overflow-wrap:break-word}
    img,svg,canvas,video{max-width:100%;height:auto}
    input,select,button{max-width:100%}
    /* App Shell */
    .app-shell{height:100dvh;display:flex;flex-direction:column;overscroll-behavior:none}
    .appbar{
      position:relative;display:flex;align-items:center;gap:10px;
      background:linear-gradient(180deg,#0d1526, #0b1220);
      border-bottom:1px solid rgba(255,255,255,.06);
      padding: max(12px, env(safe-area-inset-top)) 16px 12px 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,.25);
      z-index:10;
      max-width:100%;
      overflow:hidden;
    }
    .app-title{margin:0;font-weight:700;font-size:18px;letter-spacing:.01em;flex:1;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .icon-btn{
      width:36px;height:36px;border-radius:10px;border:1px solid rgba(255,255,255,.08);
      display:grid;place-items:center;background:rgba(255,255,255,.03);cursor:pointer;flex:0 0 auto
    }
    .content{
      flex:1;overflow:auto;scroll-behavior:smooth;
      padding:12px 14px calc(90px + env(safe-area-inset-bottom));
      background:
        radial-gradient(1200px 500px at 100% -50%, rgba(104,117,245,.06), transparent 60%),
        radial-gradient(900px 600px at -20% 120%, rgba(34,197,94,.06), transparent 60%);
      max-width:100%;
    }
    .container{max-width:var(--maxContent);margin:0 auto}
    .card{border-radius:16px;padding:16px;margin:16px 0;background:var(--surface);border:1px solid var(--ring);box-shadow:var(--shadow)}
    .title{margin:0 0 8px;font-size:16px;font-weight:700}
    .subhead{font-size:13px;color:var(--muted);margin:6px 0 6px}
    .input{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,.03);border:1px solid var(--ring);border-radius:12px;padding:12px}
    .input input,.input select{flex:1 1 0;background:transparent;border:0;outline:0;color:var(--text);font-size:16px;width:100%}
    .prefix{opacity:.9;font-size:16px;flex:0 0 auto}
    .btn{appearance:none;border:1px solid var(--ring);background:#13243e;color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer;text-align:center;transition:transform .03s ease, background .2s; width:100%}
    .btn:active{transform:scale(.98)}
    .btn.active{border-color:var(--accent);box-shadow:0 0 0 4px rgba(34,197,94,.2) inset}
    .grid{display:grid;grid-template-columns:1fr;gap:10px;width:100%}
    @media(min-width:520px){.grid.two{grid-template-columns:repeat(2,minmax(0,1fr))}.grid.three{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .totals{display:grid;gap:10px;margin-top:10px;width:100%}
    @media(min-width:420px){.totals{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .box{
  background:rgba(255,255,255,.04);
  border:1px solid var(--ring);
  border-radius:8px;
  padding:4px 6px;
  text-align:center;
  font-size:12px;
}
.pets-ok{background:rgba(0,160,60,.25);border-color:rgba(0,160,60,.8)}
.pets-in{background:rgba(255,140,0,.25);border-color:rgba(255,140,0,.9)}

.box h3{margin:0 0 2px;font-size:12px}
.total{font-size:14px}
.subhead{font-size:12px}

.box h3{font-size:11px !important}
.total{font-size:13px !important}
.subhead{font-size:11px !important}
;border:1px solid var(--ring);border-radius:12px;padding:10px;text-align:center}
    .box h3{margin:0 0 4px;font-size:12px;color:var(--muted);font-weight:600}
    .total{font-size:22px;font-weight:800}
    .row{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,.03);border:1px solid var(--ring);border-radius:12px;padding:12px}
    .neg{color:var(--danger)}
    .net{color:var(--accent);font-weight:800}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
    section[role="tabpanel"]{display:none}
    section[role="tabpanel"].active{display:block}
    .tabbar{
      position:fixed;left:0;right:0;bottom:0;z-index:15;
      padding:8px max(12px, env(safe-area-inset-left)) calc(8px + env(safe-area-inset-bottom)) max(12px, env(safe-area-inset-right));
      background:rgba(13,21,38,.86);backdrop-filter: blur(10px);
      border-top:1px solid rgba(255,255,255,.06);
      max-width:100%;
    }
    .tabs{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:8px;width:100%;max-width:var(--maxContent);margin:0 auto}
    .tab{
      --c:rgba(255,255,255,.06);
      display:flex;flex-direction:column;align-items:center;gap:6px;
      padding:10px 6px;border-radius:14px;border:1px solid var(--c);
      background:linear-gradient(180deg, var(--tab), #0c162a);
      text-align:center;color:var(--text);cursor:pointer;user-select:none;min-width:0
    }
    .tab.active{border-color:rgba(34,197,94,.35);background:linear-gradient(180deg, var(--tabActive), #132744);box-shadow:0 4px 18px rgba(34,197,94,.12)}
    .tab svg{width:20px;height:20px;opacity:.9;flex:0 0 auto}
    .tab span{font-size:11px;line-height:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}
    #tipOut{color:var(--accent)}
    #totalOut{color:var(--danger)}
    #percentOut{color:var(--info)}
    .pill{background:rgba(255,255,255,.04);border:1px solid var(--ring);border-radius:14px;padding:14px;text-align:center}
    .pill h3{margin:0 0 6px;font-size:12px;color:var(--muted);font-weight:600}
    .pill .big{display:block;font-size:22px;font-weight:800}
    .hl{color:var(--info)} .hl2{color:var(--accent2)} .ok{color:var(--accent)}
    .mode{display:flex;gap:8px;background:rgba(255,255,255,.05);border:1px solid var(--ring);padding:6px;border-radius:12px;width:100%}
    .mode button{flex:1;padding:10px;border-radius:10px;border:1px solid transparent;background:transparent;color:var(--text);cursor:pointer;min-width:0}
    .mode button.active{border-color:rgba(255,255,255,.2);background:rgba(255,255,255,.06)}
    .sa-bottom{height: env(safe-area-inset-bottom)}

    /* ---------- HOME OVERLAY ---------- */
    .home-overlay{
      position:fixed;inset:0;z-index:999;
      display:grid;place-items:center;
      background:
        radial-gradient(1200px 500px at 100% -50%, rgba(104,117,245,.10), transparent 60%),
        radial-gradient(900px 600px at -20% 120%, rgba(34,197,94,.10), transparent 60%),
        linear-gradient(180deg,#0d1526,#0b1220);
      transition:opacity .5s ease, visibility .5s ease;
    }
    .home-overlay.hide{opacity:0;visibility:hidden}
    .welcome-card{
      width:min(82vw, 360px); aspect-ratio:1/1; 
      background:linear-gradient(180deg,#0e1628,#0b1220);
      border:1px solid var(--ring); border-radius:24px; padding:18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.04);
      position:relative; overflow:hidden; isolation:isolate;
    }
    .welcome-title{font-size:18px;letter-spacing:.06em;color:var(--muted);margin:0 0 6px;text-transform:uppercase}
    .welcome-headline{font-size:28px;font-weight:800;margin:0 0 10px;line-height:1.3;text-align:center;display:flex;flex-direction:column;justify-content:center;flex:1;}
    .welcome-sub{font-size:13px;color:var(--muted);margin:0 0 14px}
    .enter-btn{
      display:inline-flex;align-items:center;justify-content:center;gap:10px;
      width:100%;padding:12px 14px;border-radius:14px;cursor:pointer;
      background:linear-gradient(180deg,#143154,#10243f); border:1px solid var(--ring); color:var(--text);
      box-shadow: var(--shadow);
      transition: transform .12s ease, box-shadow .2s ease, opacity .4s ease;
      font-weight:700; letter-spacing:.02em;
    }
    .enter-btn:active{transform:translateY(1px) scale(.99)}

    /* Animated ring inside the card */
    .ring-wrap{
      position:absolute; inset:0; z-index:-1; pointer-events:none; opacity:.8;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.35));
    }
    .ring{
      position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
      width:120%; aspect-ratio:1/1; border-radius:50%;
      background: conic-gradient(from 0deg, transparent 0 20%, rgba(56,189,248,.35) 20% 35%, transparent 35% 55%, rgba(167,139,250,.35) 55% 70%, transparent 70% 100%);
      mask: radial-gradient(circle at 50% 50%, transparent 48%, black 52%);
      animation: spin 10s linear infinite;
    }
    .ring.r2{width:100%; animation-duration: 16s; opacity:.8}
    .ring.r3{width:80%;  animation-duration: 22s; opacity:.7}

    @keyframes spin{to{transform:translate(-50%,-50%) rotate(360deg)}}

    /* Floating sparkles */
    .sparkle{
      position:absolute; width:6px; height:6px; border-radius:50%; background:currentColor; opacity:.7;
      filter: blur(.2px);
      animation: float 6s ease-in-out infinite;
    }
    .s1{ color:#22c55e; left:10%; top:72%; animation-delay:.2s}
    .s2{ color:#38bdf8; right:12%; top:18%; animation-delay:1s}
    .s3{ color:#a78bfa; left:20%; top:20%; animation-delay:2.2s}
    .s4{ color:#38bdf8; right:18%; bottom:14%; animation-delay:3.1s}
    .s5{ color:#22c55e; left:48%; top:6%; animation-delay:4s}
    @keyframes float{
      0%,100%{ transform:translateY(0) scale(1) }
      50%{ transform:translateY(-10px) scale(1.15) }
    }

    /* Content dim blur behind card */
    .glow{
      position:absolute; inset:-20%;
      background: radial-gradient(300px 300px at 65% 30%, rgba(56,189,248,.18), transparent 60%),
                  radial-gradient(360px 360px at 35% 70%, rgba(34,197,94,.16), transparent 65%),
                  radial-gradient(500px 500px at 50% 50%, rgba(167,139,250,.12), transparent 70%);
      filter: blur(40px); opacity:.9; z-index:-2;
    }

    /* Home badge */
    .badge{display:inline-block;font-size:24px;padding:10px 14px;border-radius:999px;border:1px solid var(--ring);background:rgba(255,255,255,.04);margin-bottom:10px}

    /* Reduce motion preference */
    @media (prefers-reduced-motion: reduce){
      .ring,.ring.r2,.ring.r3{animation:none}
      .sparkle{animation:none}
      .home-overlay{transition:none}
    }
  
    /* Enlarge 'cini.moD' in welcome headline */
    .welcome-headline span{font-size:34px; line-height:1.1}
    
/* ===== Mobile-fit tweaks (added) ===== */
@media (max-width: 400px){
  .appbar { padding-left: 10px; padding-right: 10px; }
  .app-title { font-size: 16px; }
  .title { font-size: 15px; }
  .welcome-headline { font-size: 24px; }
  .welcome-headline span { font-size: 28px; }
  .grid.two { grid-template-columns: 1fr !important; }
  .grid.three { grid-template-columns: 1fr !important; }
  .totals { grid-template-columns: 1fr !important; }
  .tab { padding: 10px 4px; }
  .tab span { display: none; }
  .tabs { gap: 6px; }
  .card { margin: 12px 0; padding: 14px; }
  .input { padding: 10px; }
  .enter-btn { padding: 12px; }
}

/* Slightly larger small phones */
@media (min-width: 401px) and (max-width: 480px){
  .grid.three { grid-template-columns: repeat(2, minmax(0,1fr)); }
  .totals { grid-template-columns: repeat(2, minmax(0,1fr)); }
}

/* Ensure the welcome card never overflows short viewports */
.welcome-card{
  width: min(92vw, 360px);
  max-height: 86vh;
  aspect-ratio: auto;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

/* Protect against content underlap with the tabbar */
.content {
  padding-bottom: 120px; /* will be corrected by JS based on actual tabbar height */
}


/* ===== Ensure Enter button is never hidden on mobile (added) ===== */
:root {
  /* Respect iOS/Android safe areas */
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --tabbar-h: 90px; /* updated dynamically via JS */
}

/* Give the home overlay breathing room at the bottom so buttons clear the tab bar */
#homeOverlay {
  padding-bottom: calc(var(--tabbar-h) + var(--safe-bottom) + 24px) !important;
}

/* If the Enter button sits inside a footer/actions row, keep it visible */
.welcome-actions,
.enter-row,
.enter-footer {
  position: sticky;
  bottom: calc(var(--safe-bottom) + 12px);
  padding-bottom: var(--safe-bottom);
  z-index: 5;
}

/* As an extra guard, make sure the main welcome card isn't forced offscreen */
.welcome-card {
  max-height: calc(92vh - var(--safe-bottom));
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

</style>
</head>
<body>
  <div class="app-shell">
    <header class="appbar" aria-label="App header">
      <button class="icon-btn" id="btnBack" title="Scroll to top" aria-label="Scroll to top">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M12 19V5M5 12l7-7 7 7"></path>
        </svg>
      </button>
      <h1 class="app-title" id="appTitle">Tip Calculator</h1>
      <button class="icon-btn" id="btnCopy" title="Copy summary" aria-label="Copy summary">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <rect x="9" y="9" width="13" height="13" rx="2"></rect>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
      </button>
    </header>

    <!-- HOME OVERLAY -->
    <div id="homeOverlay" class="home-overlay" role="dialog" aria-modal="true" aria-labelledby="welcomeTitle">
      <div class="welcome-card" role="group" aria-label="Welcome card">
        <div class="glow" aria-hidden="true"></div>
        <div class="ring-wrap" aria-hidden="true">
          <div class="ring"></div>
          <div class="ring r2"></div>
          <div class="ring r3"></div>
        </div>
        <span class="sparkle s1"></span>
        <span class="sparkle s2"></span>
        <span class="sparkle s3"></span>
        <span class="sparkle s4"></span>
        <span class="sparkle s5"></span>

        <div style="position:relative;z-index:1;display:flex;flex-direction:column;height:100%">
          <div style="flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;">
            <span class="badge">cini.moD</span>
            <h3 class="welcome-headline">Welcome to <span style="color:var(--accent)">cini.moD</span><br>Your pocket sidekick for work and wander!</h3>
          </div>
          <div style="margin-top:auto">
            <button id="enterBtn" class="enter-btn">Enter
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" style="width:18px;height:18px">
                <path d="M5 12h14M13 5l7 7-7 7"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <main class="content" id="content" tabindex="-1">
      <div class="container">

        <!-- OVERVIEW -->
        <section id="screen-overview" role="tabpanel" aria-labelledby="tab-overview" class="active">
          <div class="card">
            <h2 class="title">Overview</h2>
            <div class="subhead"></div>
            <div id="tz-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:8px;margin-top:6px">
              <div class="box">
                <h3>Hawai'i (HST)</h3>
                <div class="total" id="tz-hawaii">--:--</div>
                <div class="subhead" id="tz-hawaii-date" style="color:#d8c75a">--/--</div>
              </div>
              <div class="box">
                <h3>Pacific (PT)</h3>
                <div class="total" id="tz-pacific">--:--</div>
                <div class="subhead" id="tz-pacific-date" style="color:#d8c75a">--/--</div>
              </div>
              <div class="box">
                <h3>Mountain (MT)</h3>
                <div class="total" id="tz-mountain">--:--</div>
                <div class="subhead" id="tz-mountain-date" style="color:#d8c75a">--/--</div>
              </div>
              <div class="box">
                <h3>Central (CT)</h3>
                <div class="total" id="tz-central">--:--</div>
                <div class="subhead" id="tz-central-date" style="color:#d8c75a">--/--</div>
              </div>
              <div class="box">
                <h3>Eastern (ET)</h3>
                <div class="total" id="tz-eastern">--:--</div>
                <div class="subhead" id="tz-eastern-date" style="color:#d8c75a">--/--</div>
              </div>
              <div class="box">
                <h3>Zulu (UTC)</h3>
                <div class="total" id="tz-zulu">--:--</div>
                <div class="subhead" id="tz-zulu-date" style="color:#d8c75a">--/--</div>
              </div>
            </div>
          </div>

          <div class="card">
            <h2 class="title">Albuquerque Weather</h2>
            <div class="subhead" id="wx-status">Loading current conditions…</div>
            <div class="grid two">
              <div class="box">
                <h3>Temperature</h3>
                <div class="total" id="wx-temp">--</div>
              </div>
              <div class="box">
                <h3>Condition</h3>
                <div class="total" id="wx-cond">--</div>
              </div>
              <div class="box">
                <h3>Wind</h3>
                <div class="total" id="wx-wind">--</div>
              </div>
            </div>

            <div class="subhead" style="margin-top:10px">Next 8 Hours</div>
            <div id="wx-hourly" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(60px,1fr));gap:8px;overflow-x:visible;padding-bottom:4px;margin-top:6px">
              <!-- Hourly forecast cards injected by JS -->
            </div>


            <div class="subhead" style="margin-top:10px">Following 8 Hours</div>
            <div id="wx-hourly-next" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(60px,1fr));gap:8px;overflow-x:visible;padding-bottom:4px;margin-top:6px">
              <!-- Next 8 hours after the first block -->
            </div>

            <div class="subhead" style="margin-top:10px">Pet Comfort </div>
            <div id="pets-box" class="box" style="margin-top:6px">
              <h3 id="pets-label">Pets status</h3>
              <div class="total" id="pets-text">Checking forecast…</div>
            </div>
          </div>
        </section>

        <!-- TIP -->

        <section id="screen-tip" role="tabpanel" aria-labelledby="tab-tip">
          <div class="card">
            <h2 class="title">Tip Calculator</h2>
            <div class="subhead">Bill amount pre tax</div>
            <div class="input"><span class="prefix">$</span><input id="bill" inputmode="decimal" placeholder="0.00" autocomplete="off"></div>

            <div class="subhead">Preset percentage</div>
            <div class="grid two" role="group" aria-label="Choose tip %">
              <button class="btn tip" data-tip="20">20%</button>
              <button class="btn tip" data-tip="25">25%</button>
              <button class="btn tip" data-tip="30">30%</button>
              <button class="btn tip" data-tip="35">35%</button>
            </div>

            <div class="subhead">Custom percentage</div>
            <div class="input"><input id="customTip" inputmode="decimal" placeholder="Custom Percentage"><span class="prefix">%</span></div>

            <div class="totals">
              <div class="box"><h3>Tip</h3><div id="tipOut" class="total">$0.00</div></div>
              <div class="box"><h3>Total</h3><div id="totalOut" class="total">$0.00</div></div>
              <div class="box"><h3>Tip %</h3><div id="percentOut" class="total">0%</div></div>
            </div>

            <div class="grid two" style="margin-top:10px">
              <button id="reset" class="btn">Reset</button>
              <button id="copy" class="btn">Copy summary</button>
            </div>
          </div>
        </section>

        <!-- SALARY -->
        <section id="screen-salary" role="tabpanel" aria-labelledby="tab-salary">
          <div class="card">
            <h2 class="title">Salary Calculator</h2>
            <div class="grid three">
              <div>
                <div class="subhead">Hourly rate</div>
                <div class="input"><span class="prefix">$</span><input id="hourly" inputmode="decimal" placeholder="0.00"></div>
              </div>
              <div>
                <div class="subhead">Monthly pay</div>
                <div class="input"><span class="prefix">$</span><input id="monthly" inputmode="decimal" placeholder="0.00"></div>
              </div>
              <div>
                <div class="subhead">Annual salary</div>
                <div class="input"><span class="prefix">$</span><input id="annual" inputmode="decimal" placeholder="0.00"></div>
              </div>
            </div>
            <p class="hint">Assumes 2,080 hours per year (40 hrs/week × 52 weeks).</p>
          </div>
        </section>

        <!-- PAYCHECK -->
        <section id="screen-pay" role="tabpanel" aria-labelledby="tab-pay">
          <div class="card">
            <h2 class="title">Paycheck After Taxes (NM)</h2>
            <div class="grid two">
              <div>
                <div class="subhead">Hourly rate</div>
                <div class="input"><span class="prefix">$</span><input id="p_hourly" inputmode="decimal" placeholder="0.00"></div>
              </div>
              <div>
                <div class="subhead">Regular hours</div>
                <div class="input"><input id="p_hours_reg" inputmode="decimal" placeholder="80" value="80"></div>
              </div>
              <div>
                <div class="subhead">Overtime hours</div>
                <div class="input"><input id="p_hours_ot" inputmode="decimal" placeholder="0"></div>
              </div>
              <div>
                <div class="subhead">Overtime multiplier</div>
                <div class="input"><input id="p_ot_mult" inputmode="decimal" placeholder="1.5" value="1.5"></div>
              </div>
              <div>
                <div class="subhead">Pre-tax deductions (this paycheck)</div>
                <div class="input"><span class="prefix">$</span><input id="p_pretax" inputmode="decimal" placeholder="0.00"></div>
              </div>
              <div>
                <div class="subhead">YTD wages for Social Security</div>
                <div class="input"><span class="prefix">$</span><input id="p_ytd" inputmode="decimal" placeholder="0.00"></div>
              </div>
              <div>
                <div class="subhead">Filing status</div>
                <div class="input">
                  <select id="p_status">
                    <option value="single">Single</option>
                    <option value="married">Married filing jointly</option>
                    <option value="hoh">Head of household</option>
                  </select>
                </div>
              </div>
              <div>
                <div class="subhead">Pay frequency</div>
                <div class="input">
                  <select id="p_freq">
                    <option value="biweekly" selected>Biweekly (26/yr)</option>
                    <option value="weekly">Weekly (52/yr)</option>
                    <option value="semimonthly">Semi-monthly (24/yr)</option>
                    <option value="monthly">Monthly (12/yr)</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="grid" style="margin-top:6px">
              <div class="row"><span>Gross Pay</span><b id="p_gross">$0.00</b></div>
              <div class="row"><span>Federal Income Tax (est.)</span><b class="neg" id="p_fed">$0.00</b></div>
              <div class="row"><span>New Mexico Income Tax (est.)</span><b class="neg" id="p_state">$0.00</b></div>
              <div class="row"><span>Social Security 6.2%</span><b class="neg" id="p_ss">$0.00</b></div>
              <div class="row"><span>Medicare 1.45%</span><b class="neg" id="p_medicare">$0.00</b></div>
              <div class="row"><span>Net Pay (take-home)</span><b class="net" id="p_net">$0.00</b></div>
              <p class="hint">Estimates only. Uses 2025 federal brackets, 2025 standard deduction, and current NM brackets. Social Security respects your YTD cap. Pre-tax reduces federal/state taxable wages only.</p>
            </div>
          </div>
        </section>

        <!-- TIME -->
        <section id="screen-time" role="tabpanel" aria-labelledby="tab-time">
          <div class="card">
            <h2 class="title">Your Time & Their Time</h2>
            <div class="grid two">
              <div>
                <div class="subhead">Your Airport (default ABQ)</div>
                <div class="input"><input id="t_from" list="iataList" value="ABQ" placeholder="Enter code"></div>
              </div>
              <div>
                <div class="subhead">Their Airport</div>
                <div class="input"><input id="t_to" list="iataList" placeholder="Enter code"></div>
              </div>
            </div>
            <div class="grid two" style="margin-top:8px">
              <div>
                <div class="subhead">Set Your Time (at your airport)</div>
                <div class="input"><input id="t_when" type="datetime-local"></div>
              </div>
              <div style="display:flex;align-items:flex-end"><button id="t_now" class="btn" style="width:100%">Use current time</button></div>
            </div>
            <div class="grid" style="margin-top:8px">
              <div class="row"><strong>Your Time:</strong> <span id="t_from_out">—</span></div>
              <div class="row"><strong>Their Time:</strong> <span id="t_to_out">—</span></div>
              <div id="t_offset_display" class="row"><strong>Offset:</strong> <span id="t_offset_txt">—</span></div>
            </div>
          </div>
        </section>

        <!-- SW POINTS -->
        <section id="screen-sw" role="tabpanel" aria-labelledby="tab-sw">
          <div class="card">
            <h2 class="title">Southwest Points per Dollar</h2>

            <div class="subhead">How do you want to enter price?</div>
            <div class="mode" role="tablist" aria-label="Price entry mode">
              <button id="sw-mode-base" class="active" aria-selected="true" role="tab">I know the base fare</button>
              <button id="sw-mode-est" role="tab">Estimate base from total</button>
            </div>

            <div id="sw-inputs" class="grid two" style="margin-top:10px">
              <div id="sw-baseFareBlock">
                <div class="subhead">Base fare (excluding taxes/fees)</div>
                <div class="input"><span class="prefix">$</span><input id="sw-baseFare" type="number" inputmode="decimal" min="0" step="0.01" placeholder="e.g., 175.00" /></div>
              </div>
              <div id="sw-totalPriceBlock">
                <div class="subhead">Total ticket price charged to card</div>
                <div class="input"><span class="prefix">$</span><input id="sw-totalPrice" type="number" inputmode="decimal" min="0" step="0.01" placeholder="e.g., 225.00" /></div>
              </div>
              <div id="sw-basePctBlock" style="display:none">
                <div class="subhead">If estimating: percent of total that is base fare</div>
                <div class="input"><input id="sw-basePct" type="number" min="0" max="100" step="1" value="70" /><span class="prefix">%</span></div>
                <p class="hint">If you do not know the base fare, a 60–80% range is common. Adjust as needed.</p>
              </div>
              <div>
                <div class="subhead">Fare type</div>
                <div class="input">
                  <select id="sw-fareType">
                    <option value="2">Basic · 2 pts/$</option>
                    <option value="6">Choice · 6 pts/$</option>
                    <option value="10">Choice Preferred · 10 pts/$</option>
                    <option value="14">Choice Extra · 14 pts/$</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="grid" style="margin-top:6px">
              <div class="row"><label><input id="sw-useCard" type="checkbox" /> Use a Southwest credit card for purchase</label></div>
              <div id="sw-cardRow" class="grid two" style="display:none">
                <div>
                  <div class="subhead">Select your Southwest card</div>
                  <div class="input">
                    <select id="sw-cardType">
                      <option value="2">Southwest Plus · 2X</option>
                      <option value="3">Southwest Premier · 3X</option>
                      <option value="4">Southwest Priority · 4X</option>
                      <option value="3">Premier Business · 3X</option>
                      <option value="4">Performance Business · 4X</option>
                    </select>
                  </div>
                  <p class="hint">Applies the correct multiplier to the card charge.</p>
                </div>
              </div>
            </div>

            <div class="grid two" style="margin-top:8px">
              <div class="pill">
                <h3>Flight points</h3>
                <span id="sw-flightPts" class="big hl">0</span>
              </div>
              <div class="pill">
                <h3>Credit card points</h3>
                <span id="sw-cardPts" class="big hl2">0</span>
              </div>
              <div class="pill">
                <h3>Total points</h3>
                <span id="sw-totalPts" class="big ok">0</span>
              </div>
              <div class="pill">
                <h3>Effective pts per $</h3>
                <span id="sw-ppd" class="big">0.00</span>
              </div>
            </div>
            <p class="hint" style="margin-top:8px">Estimates flight points on base fare and card points on total charge.</p>
          </div>

          <!-- Converter -->
          <div class="card">
            <h2 class="title">Points to Dollars</h2>
            <div class="grid two">
              <div>
                <div class="subhead">Points to redeem</div>
                <div class="input"><input id="sw-pointsInput" type="number" min="0" step="1" placeholder="e.g., 12500" /></div>
              </div>
              <div>
                <div class="subhead">Value per point (USD)</div>
                <div class="input"><input id="sw-pointValue" type="number" min="0" step="0.0001" value="0.0149" /></div>
                <p class="hint">Defaults to $0.0149 per point. Adjust as needed.</p>
              </div>
            </div>
            <div class="grid two" style="margin-top:8px">
              <div class="pill">
                <h3>Estimated dollar cost</h3>
                <span id="sw-dollarValue" class="big ok">$0.00</span>
              </div>
              <div class="pill">
                <h3>Cents per point</h3>
                <span id="sw-cpp" class="big hl">1.49¢</span>
              </div>
            </div>
          </div>
        </section>
      </div>

      <datalist id="iataList"></datalist>
      <div class="sa-bottom"></div>
    </main>

    <nav class="tabbar" role="tablist" aria-label="Bottom tabs">
      <div class="tabs">
        <button class="tab active" id="tab-overview" data-screen="overview" aria-selected="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="16" rx="4"></rect>
            <path d="M9 9h9M9 13h6M9 17h4"></path>
          </svg>
          <span>Overview</span>
        </button>
        <button class="tab" id="tab-tip" data-screen="tip">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M12 1v22M17 5c0-1.5-2.5-3-5-3s-5 1.5-5 3 2.5 3 5 3 5 1.5 5 3-2.5 3-5 3-5 1.5-5 3 2.5 3 5 3 5-1.5 5-3"/>
  </svg>
  <span>Tip</span>
</button>
        <button class="tab" id="tab-salary" data-screen="salary">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7h18M3 12h18M3 17h18"/><rect x="4" y="5" width="16" height="14" rx="3"/></svg>
          <span>Salary</span>
        </button>
        <button class="tab" id="tab-pay" data-screen="pay">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="16" rx="3"/><path d="M7 9h10M7 13h6"/></svg>
          <span>Paycheck</span>
        </button>
        <button class="tab" id="tab-time" data-screen="time">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>
          <span>Time</span>
        </button>
        <button class="tab" id="tab-sw" data-screen="sw">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12s4-8 9-8 9 8 9 8-4 8-9 8-9-8-9-8z"/><path d="M12 4v16"/></svg>
          <span>Points</span>
        </button>
      </div>
    </nav>
  </div>

  <script>
    // Helpers
    const $ = s=>document.querySelector(s);
    const $$ = s=>[...document.querySelectorAll(s)];
    const nf = new Intl.NumberFormat('en-US',{style:'currency',currency:'USD'});
    const setTitle = t => $('#appTitle').textContent = t;

    // Bottom tab routing
    const SCREENS = ['overview','tip','salary','pay','time','sw'];
    const TITLES = {overview:'Overview', tip:'Tip Calculator', salary:'Salary Calculator', pay:'Paycheck After Taxes', time:'Your Time & Their Time', sw:'Southwest Points'};

    function show(screen){
      SCREENS.forEach(id=>{
        const tab = $('#tab-' + id);
        const panel = $('#screen-' + id);
        const active = id === screen;
        tab.classList.toggle('active', active);
        tab.setAttribute('aria-selected', String(active));
        panel.classList.toggle('active', active);
      });
      setTitle(TITLES[screen] || 'Tools');
      history.replaceState(null,'','#' + screen);
      $('#content').focus({preventScroll:true});
      document.scrollingElement.scrollLeft = 0;
    }

    function initFromHash(){
      const h = location.hash.replace('#','');
      if(SCREENS.includes(h)) show(h);
    }

    // Header buttons
    $('#btnBack').addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));
    $('#btnCopy').addEventListener('click',()=>{
      if($('#screen-tip').classList.contains('active')){
        const bill=$('#bill'), percentOut=$('#percentOut'), tipOut=$('#tipOut'), totalOut=$('#totalOut');
        const s=`Bill: ${bill.value||nf.format(0)}\\nTip: ${percentOut.textContent}\\nTip Amount: ${tipOut.textContent}\\nTotal: ${totalOut.textContent}`;
        navigator.clipboard.writeText(s).catch(()=>{});
      } else {
        navigator.clipboard.writeText($('#appTitle').textContent).catch(()=>{});
      }
    });

    // Tab clicks
    $$('.tab').forEach(btn=>btn.addEventListener('click',()=>show(btn.dataset.screen)));
    window.addEventListener('hashchange', initFromHash);
    initFromHash();

    // ===== HOME OVERLAY ENTER BEHAVIOR =====
    const home = $('#homeOverlay');
    const enterBtn = $('#enterBtn');
    function enterApp(){
      // Fade the overlay and then remove it from flow
      home.classList.add('hide');
      // Ensure we land on the overview dashboard first
      show('overview');
      // Optional: remember last time used (comment out if not wanted)
      // localStorage.setItem('cini_mod_last_enter', Date.now());
    }
    enterBtn.addEventListener('click', ()=>{
      // slight delay to let the button press feel responsive
      setTimeout(enterApp, 120);
    });

    // Close overlay if user deep-links into a specific screen via hash
    if(location.hash && SCREENS.includes(location.hash.slice(1))){
      home.classList.add('hide');
    }

    // ===== TIP =====
    const bill=$('#bill'), customTip=$('#customTip'), tipBtns=$$('.tip');
    const tipOut=$('#tipOut'), totalOut=$('#totalOut'), percentOut=$('#percentOut');
    let tipPercent=0.20;
    function setActive(p){tipBtns.forEach(b=>b.classList.toggle('active',Number(b.dataset.tip)/100===p))}
    function calcTip(){
      const b=(Number(String(bill.value).replace(/[^0-9.]/g,''))||0);
      const c=(Number(String(customTip.value).replace(/[^0-9.]/g,''))||0);
      if(c>0){tipPercent=c/100; setActive(-1);}
      const tip=b*tipPercent;
      tipOut.textContent=nf.format(tip);
      totalOut.textContent=nf.format(b+tip);
      percentOut.textContent=`${Math.round(tipPercent*100)}%`;
    }
    tipBtns.forEach(btn=>btn.addEventListener('click',()=>{tipPercent=Number(btn.dataset.tip)/100; customTip.value=''; setActive(tipPercent); calcTip();}));
    ['input','change'].forEach(e=>{bill.addEventListener(e,calcTip); customTip.addEventListener(e,calcTip);});
    setActive(tipPercent); calcTip();
    $('#reset').addEventListener('click',()=>{bill.value=''; customTip.value=''; tipPercent=.2; setActive(tipPercent); calcTip();});
    $('#copy').addEventListener('click',async()=>{
      const s=`Bill: ${bill.value||nf.format(0)}\\nTip: ${percentOut.textContent}\\nTip Amount: ${tipOut.textContent}\\nTotal: ${totalOut.textContent}`;
      try{await navigator.clipboard.writeText(s);}catch{}
    });

    // ===== SALARY =====
    const HOURS_PER_YEAR=2080, MONTHS=12;
    const hourly=$('#hourly'), monthly=$('#monthly'), annual=$('#annual'); let lock=false;
    function parseNum(v){v=String(v??'').replace(/[^0-9.,-]/g,'').replace(',','.'); const n=parseFloat(v); return isFinite(n)?n:0;}
    function fmt(v){return nf.format(v||0)}
    function fromHourly(){if(lock)return; lock=true; const h=parseNum(hourly.value); annual.value=h?fmt(h*HOURS_PER_YEAR):''; monthly.value=h?fmt(h*HOURS_PER_YEAR/MONTHS):''; lock=false;}
    function fromMonthly(){if(lock)return; lock=true; const m=parseNum(monthly.value); annual.value=m?fmt(m*MONTHS):''; hourly.value=m?fmt(m*MONTHS/HOURS_PER_YEAR):''; lock=false;}
    function fromAnnual(){if(lock)return; lock=true; const a=parseNum(annual.value); hourly.value=a?fmt(a/HOURS_PER_YEAR):''; monthly.value=a?fmt(a/MONTHS):''; lock=false;}
    ['input','change'].forEach(e=>{hourly.addEventListener(e,fromHourly); monthly.addEventListener(e,fromMonthly); annual.addEventListener(e,fromAnnual);});

    // ===== PAYCHECK (NM) =====
    const SS_RATE=.062, MED_RATE=.0145, SS_WAGE_BASE_2025=176100;
    const STD_DED={single:15750, married:31500, hoh:23625};
    const FED_BRACKETS_2025={
      single:[[11925,.10],[48475,.12],[103350,.22],[197300,.24],[250525,.32],[626350,.35],[Infinity,.37]],
      married:[[23850,.10],[96950,.12],[206700,.22],[394600,.24],[501050,.32],[751600,.35],[Infinity,.37]],
      hoh:[[17000,.10],[64850,.12],[103350,.22],[197300,.24],[250500,.32],[626350,.35],[Infinity,.37]]
    };
    const NM_BRACKETS=[[5500,.017],[16500,.032],[33500,.043],[66500,.047],[210000,.049],[Infinity,.059]];

    const p_hourly=$('#p_hourly'), p_hours_reg=$('#p_hours_reg'), p_hours_ot=$('#p_hours_ot'), p_ot_mult=$('#p_ot_mult'), p_pretax=$('#p_pretax'), p_ytd=$('#p_ytd');
    const p_status=$('#p_status'), p_freq=$('#p_freq'); const p_gross=$('#p_gross'), p_fed=$('#p_fed'), p_state=$('#p_state'), p_ss=$('#p_ss'), p_medicare=$('#p_medicare'), p_net=$('#p_net');
    function perYearCount(f){return f==='weekly'?52:f==='semimonthly'?24:f==='monthly'?12:26}
    function defaultHours(f){return f==='weekly'?40:f==='semimonthly'?86.67:f==='monthly'?173.33:80}
    function taxFromBrackets(taxable,br){let tax=0,last=0;for(const[cap,rate]of br){const span=Math.max(0,Math.min(taxable,cap)-last); if(span>0) tax+=span*rate; if(taxable<=cap) break; last=cap;}return tax}
    function calcPay(){
      const hourly=parseNum(p_hourly.value); const freq=p_freq.value; const periods=perYearCount(freq);
      const regH=p_hours_reg.value.trim()===''?defaultHours(freq):parseNum(p_hours_reg.value)||0; const otH=p_hours_ot.value.trim()===''?0:parseNum(p_hours_ot.value)||0; const otM=parseNum(p_ot_mult.value)||1.5;
      const pretax=parseNum(p_pretax.value)||0; const ytd=parseNum(p_ytd.value)||0; const status=p_status.value;
      const gross=hourly*regH + hourly*otH*otM; const annualTaxable=Math.max(0,(gross-pretax)*periods);
      const taxableFed=Math.max(0,annualTaxable-STD_DED[status]); const fedAnnual=taxFromBrackets(taxableFed,FED_BRACKETS_2025[status]); const fed=fedAnnual/periods;
      const nm=taxFromBrackets(annualTaxable,NM_BRACKETS)/periods; const remainingSS=Math.max(0,SS_WAGE_BASE_2025-ytd); const ss=Math.min(gross,remainingSS)*SS_RATE; const med=gross*MED_RATE;
      const net=gross-pretax-fed-nm-ss-med;
      p_gross.textContent=fmt(gross); p_fed.textContent=fmt(Math.max(0,fed)); p_state.textContent=fmt(Math.max(0,nm)); p_ss.textContent=fmt(Math.max(0,ss)); p_medicare.textContent=fmt(Math.max(0,med)); p_net.textContent=fmt(Math.max(0,net));
    }
    ['input','change'].forEach(e=>{[p_hourly,p_hours_reg,p_hours_ot,p_ot_mult,p_pretax,p_ytd,p_status,p_freq].forEach(el=>el.addEventListener(e,calcPay));}); calcPay();

    // ===== SOUTHWEST POINTS =====
    const swState={mode:'base',baseFare:0,totalPrice:0,basePct:70,fareMult:2,useCard:false,cardMult:2};
    try{ Object.assign(swState, JSON.parse(localStorage.getItem('sw_ppd_calc_v1')||'{}')); }catch{}
    const sw={
      modeBase:$('#sw-mode-base'), modeEst:$('#sw-mode-est'),
      baseFare:$('#sw-baseFare'), totalPrice:$('#sw-totalPrice'), basePct:$('#sw-basePct'),
      baseFareBlock:$('#sw-baseFareBlock'), basePctBlock:$('#sw-basePctBlock'), totalPriceBlock:$('#sw-totalPriceBlock'),
      fareType:$('#sw-fareType'), useCard:$('#sw-useCard'), cardRow:$('#sw-cardRow'), cardType:$('#sw-cardType'),
      flightPts:$('#sw-flightPts'), cardPts:$('#sw-cardPts'), totalPts:$('#sw-totalPts'), ppd:$('#sw-ppd'),
      pointsInput:$('#sw-pointsInput'), pointValue:$('#sw-pointValue'), dollarValue:$('#sw-dollarValue'), cpp:$('#sw-cpp')
    };
    function swSync(){
      sw.modeBase.classList.toggle('active', swState.mode==='base');
      sw.modeEst.classList.toggle('active', swState.mode==='est');
      sw.baseFareBlock.style.display = swState.mode==='base' ? '' : 'none';
      sw.basePctBlock.style.display = swState.mode==='est' ? '' : 'none';
      sw.baseFare.value = swState.baseFare || '';
      sw.totalPrice.value = swState.totalPrice || '';
      sw.basePct.value = swState.basePct;
      sw.fareType.value = String(swState.fareMult);
      sw.useCard.checked = swState.useCard;
      sw.cardRow.style.display = swState.useCard ? '' : 'none';
      sw.cardType.value = swState.cardMult;
      swCalc();
    }
    function swSave(){ localStorage.setItem('sw_ppd_calc_v1', JSON.stringify(swState)); }
    function swParse(v){ const n=parseFloat(v); return Number.isFinite(n)?n:0; }
    function swBaseFare(){ return swState.mode==='base' ? Math.max(0, swState.baseFare) : Math.max(0, swState.totalPrice * (Math.min(100, Math.max(0, swState.basePct))/100)); }
    function swCalc(){
      const base=swBaseFare();
      const flight=Math.floor(base*swState.fareMult);
      const card=swState.useCard?Math.floor(swState.totalPrice*swState.cardMult):0;
      const total=flight+card;
      const ppd = swState.totalPrice>0 ? (total/swState.totalPrice) : 0;
      sw.flightPts.textContent=flight.toLocaleString();
      sw.cardPts.textContent=card.toLocaleString();
      sw.totalPts.textContent=total.toLocaleString();
      sw.ppd.textContent=ppd.toFixed(2);
      swSave();
    }
    sw.modeBase.addEventListener('click',()=>{swState.mode='base'; swSync();});
    sw.modeEst .addEventListener('click',()=>{swState.mode='est';  swSync();});
    sw.baseFare .addEventListener('input',e=>{swState.baseFare=swParse(e.target.value); swCalc();});
    sw.totalPrice.addEventListener('input',e=>{swState.totalPrice=swParse(e.target.value); swCalc();});
    sw.basePct  .addEventListener('input',e=>{swState.basePct=swParse(e.target.value); swCalc();});
    sw.fareType .addEventListener('change',e=>{swState.fareMult=swParse(e.target.value); swCalc();});
    sw.useCard  .addEventListener('change',e=>{swState.useCard=e.target.checked; sw.cardRow.style.display=swState.useCard?'':'none'; swCalc();});
    sw.cardType .addEventListener('change',e=>{swState.cardMult=swParse(e.target.value); swCalc();});

    function swFmtUSD(n){return n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:2});}
    function swUpdatePTD(){ const pts=swParse(sw.pointsInput.value); const val=parseFloat(sw.pointValue.value)||0; const dollars=pts*val; $('#sw-dollarValue').textContent=swFmtUSD(dollars); $('#sw-cpp').textContent=(val*100).toFixed(2)+'¢'; }
    sw.pointsInput && sw.pointsInput.addEventListener('input', swUpdatePTD);
    sw.pointValue && sw.pointValue.addEventListener('input', swUpdatePTD);
    swSync(); swUpdatePTD();

    // ===== TIME =====
    const IATA_TZ={
      ALB:'America/New_York', ABQ:'America/Denver', ANC:'America/Anchorage', AMA:'America/Chicago', ATL:'America/New_York', AUS:'America/Chicago',
      BWI:'America/New_York', BHM:'America/Chicago', BOI:'America/Boise', BOS:'America/New_York', BZN:'America/Denver', BUF:'America/New_York', BUR:'America/Los_Angeles',
      CHS:'America/New_York', CLT:'America/New_York', MDW:'America/Chicago', ORD:'America/Chicago', CVG:'America/New_York', CLE:'America/New_York', COS:'America/Denver',
      CMH:'America/New_York', CRP:'America/Chicago', DAL:'America/Chicago', DEN:'America/Denver', DSM:'America/Chicago', VPS:'America/Chicago', DTW:'America/Detroit',
      ELP:'America/Denver', EUG:'America/Los_Angeles', FLL:'America/New_York', RSW:'America/New_York', FAT:'America/Los_Angeles', GRR:'America/Detroit', GSP:'America/New_York',
      HRL:'America/Chicago', BDL:'America/New_York', HOU:'America/Chicago', IND:'America/Indiana/Indianapolis', JAN:'America/Chicago', JAX:'America/New_York',
      MCI:'America/Chicago', TYS:'America/New_York', LAS:'America/Los_Angeles', LIT:'America/Chicago', LGB:'America/Los_Angeles', ISP:'America/New_York', LAX:'America/Los_Angeles',
      SDF:'America/Kentucky/Louisville', LBB:'America/Chicago', MHT:'America/New_York', MEM:'America/Chicago', MIA:'America/New_York', MAF:'America/Chicago', MKE:'America/Chicago',
      MSP:'America/Chicago', MTJ:'America/Denver', MYR:'America/New_York', BNA:'America/Chicago', MSY:'America/Chicago', LGA:'America/New_York', ORF:'America/New_York',
      OAK:'America/Los_Angeles', OKC:'America/Chicago', OMA:'America/Chicago', ONT:'America/Los_Angeles', SNA:'America/Los_Angeles', MCO:'America/New_York', PSP:'America/Los_Angeles',
      ECP:'America/Chicago', PNS:'America/Chicago', PHL:'America/New_York', PHX:'America/Phoenix', PIT:'America/New_York', PWM:'America/New_York', PDX:'America/Los_Angeles',
      PVD:'America/New_York', RDU:'America/New_York', RNO:'America/Los_Angeles', RIC:'America/New_York', ROC:'America/New_York', SMF:'America/Los_Angeles', SLC:'America/Denver',
      SAT:'America/Chicago', SAN:'America/Los_Angeles', SFO:'America/Los_Angeles', SJC:'America/Los_Angeles', SBA:'America/Los_Angeles', STS:'America/Los_Angeles',
      SRQ:'America/New_York', SAV:'America/New_York', SEA:'America/Los_Angeles', GEG:'America/Los_Angeles', STL:'America/Chicago', HDN:'America/Denver',
      TPA:'America/New_York', TUS:'America/Phoenix', TUL:'America/Chicago', IAD:'America/New_York', DCA:'America/New_York', PBI:'America/New_York', ICT:'America/Chicago',
      AUA:'America/Aruba', BZE:'America/Belize', CUN:'America/Cancun', GCM:'America/Cayman', HAV:'America/Havana', LIR:'America/Costa_Rica', SJD:'America/Mazatlan',
      MBJ:'America/Jamaica', NAS:'America/Nassau', PLS:'America/Grand_Turk', PVR:'America/Mexico_City', PUJ:'America/Santo_Domingo', SJO:'America/Costa_Rica',
      SJU:'America/Puerto_Rico', SXM:'America/Lower_Princes', STT:'America/St_Thomas', ITO:'Pacific/Honolulu', HNL:'Pacific/Honolulu', OGG:'Pacific/Honolulu',
      KOA:'Pacific/Honolulu', LIH:'Pacific/Honolulu'
    };
    const list=$('#iataList'); Object.keys(IATA_TZ).forEach(code=>{const o=document.createElement('option'); o.value=code; list.appendChild(o)});

    const t_from=$('#t_from'), t_to=$('#t_to'), t_when=$('#t_when'), t_now=$('#t_now');
    const t_from_out=$('#t_from_out'), t_to_out=$('#t_to_out'), t_offset_display=$('#t_offset_display'), t_offset_txt=$('#t_offset_txt');

    function setNow(){
      const fromCode=(t_from.value||'ABQ').toUpperCase(); const fromTZ=IATA_TZ[fromCode]||'America/Denver';
      const now=new Date(); const parts=new Intl.DateTimeFormat('sv-SE',{timeZone:fromTZ,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}).formatToParts(now);
      const P=Object.fromEntries(parts.map(p=>[p.type,p.value])); t_when.value=`${P.year}-${P.month}-${P.day}T${P.hour}:${P.minute}`;
    }
    function parseLocalToUTC(localStr,tz){ if(!localStr) return null; const [date,time]=localStr.split('T'); const[y,m,d]=date.split('-').map(Number); const[hh,mm]=time.split(':').map(Number);
      let guess=new Date(Date.UTC(y,m-1,d,hh,mm)); for(let i=0;i<3;i++){ const parts=new Intl.DateTimeFormat('sv-SE',{timeZone:tz,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}).formatToParts(guess);
        const P=Object.fromEntries(parts.map(p=>[p.type,p.value])); const diff=(Number(P.hour)*60+Number(P.minute))-(hh*60+mm); if(diff===0) break; guess=new Date(guess.getTime()-diff*60*1000);} return guess; }
    function fmtInTZ(d,tz){ return new Intl.DateTimeFormat('en-US',{timeZone:tz,month:'short',day:'2-digit',hour:'2-digit',minute:'2-digit',hour12:true}).format(d); }
    function getOffsetHours(fromTZ,toTZ,base){ const fromTime=new Date(base.toLocaleString('en-US',{timeZone:fromTZ})); const toTime=new Date(base.toLocaleString('en-US',{timeZone:toTZ})); return (toTime-fromTime)/(1000*60*60); }

    function runTime(){
      const fromCode=(t_from.value||'ABQ').toUpperCase(); const toCode=(t_to.value||'ABQ').toUpperCase();
      const fromTZ=IATA_TZ[fromCode]; const toTZ=IATA_TZ[toCode]; if(!fromTZ||!toTZ) return;
      const base=parseLocalToUTC(t_when.value,fromTZ); if(!base) return;
      t_from_out.textContent=`${fmtInTZ(base,fromTZ)} (${fromCode})`; t_to_out.textContent=`${fmtInTZ(base,toTZ)} (${toCode})`;
      const off=getOffsetHours(fromTZ,toTZ,base); let txt='Same Time'; if(off>0) txt=`+${off.toFixed(1)} hr`; else if(off<0) txt=`${off.toFixed(1)} hr`;
      t_offset_txt.textContent=txt;
      t_offset_display.className='row '+(off>0?'plus':off<0?'minus':'');
    }

    $('#t_now').addEventListener('click',()=>{setNow();runTime();});
    ['input','change'].forEach(e=>{
      t_from.addEventListener(e,()=>{setNow();runTime();});
      t_to.addEventListener(e,runTime);
      t_when.addEventListener(e,runTime);
    });
    setNow(); runTime();
  
    // ===== OVERVIEW DASHBOARD (Time Zones + ABQ Weather) =====
    const tzEls = {
      hawaii: $('#tz-hawaii'),
      pacific: $('#tz-pacific'),
      mountain: $('#tz-mountain'),
      central: $('#tz-central'),
      eastern: $('#tz-eastern'),
      zulu: $('#tz-zulu')
    };

    function formatTimeForZone(timeZone) {
      const now = new Date();
      return new Intl.DateTimeFormat('en-US', {
        hour: '2-digit',
        minute: '2-digit',
        
        hour12: true,
        timeZone
      }).format(now);
    }

    function updateTimeZones() {
      if (!tzEls.hawaii) return; // Overview screen might not be mounted yet
      tzEls.hawaii.textContent  = formatTimeForZone('Pacific/Honolulu');
      tzEls.pacific.textContent = formatTimeForZone('America/Los_Angeles');
      tzEls.mountain.textContent= formatTimeForZone('America/Denver');
      tzEls.central.textContent = formatTimeForZone('America/Chicago');
      tzEls.eastern.textContent = formatTimeForZone('America/New_York');
      tzEls.zulu.textContent    = formatTimeForZone('UTC');
    }
    updateTimeZones();
    function formatDateForZone(timeZone) {
      const now = new Date();
      return new Intl.DateTimeFormat('en-US', {
        month: '2-digit',
        day: '2-digit',
        timeZone
      }).format(now);
    }
    function updateTimeZoneDates(){
      const map = {
        'tz-hawaii-date':'Pacific/Honolulu',
        'tz-pacific-date':'America/Los_Angeles',
        'tz-mountain-date':'America/Denver',
        'tz-central-date':'America/Chicago',
        'tz-eastern-date':'America/New_York',
        'tz-zulu-date':'UTC'
      };
      Object.entries(map).forEach(([id,tz])=>{
        const el = document.getElementById(id);
        if (el) el.textContent = formatDateForZone(tz);
      });
    }
    updateTimeZoneDates();

    setInterval(updateTimeZones, 1000);
    setInterval(updateTimeZoneDates, 60 * 1000);

    // Simple helpers for weather
    const wxStatusEl = $('#wx-status');
    const wxTempEl   = $('#wx-temp');
    const wxCondEl   = $('#wx-cond');
    const wxWindEl   = $('#wx-wind');
    const wxHourlyEl = $('#wx-hourly');

    function cToF(c) {
      return (c * 9/5) + 32;
    }
    function kmhToMph(kmh) {
      return kmh * 0.621371;
    }

    // Map Open-Meteo WMO weather codes to simple condition labels
    function mapWeatherCondition(code, tempC, windKmh) {
      const tempF = cToF(tempC);
      let base = '';

      if (code === 0) {
        base = 'Clear';
      } else if (code >= 1 && code <= 3) {
        base = 'Partly cloudy';
      } else if (code >= 45 && code <= 48) {
        base = 'Foggy';
      } else if ((code >= 51 && code <= 57) || (code >= 61 && code <= 67) || (code >= 80 && code <= 82)) {
        base = 'Rain';
      } else if ((code >= 71 && code <= 77) || (code >= 85 && code <= 86)) {
        base = 'Snow';
      } else if (code >= 95) {
        base = 'Storm';
      } else {
        base = 'Cloudy';
      }

      // Special tags from your list
      if ((code === 66 || code === 67 || code === 77) && tempF <= 34) {
        base = 'Ice';
      } else if (tempF >= 90 && !(code >= 61 && code <= 67) && !(code >= 71 && code <= 77)) {
        base = 'Hot';
      }

      if (windKmh >= 35) {
        if (base === 'Clear') return 'Windy & Clear';
        if (base === 'Rain') return 'Windy & Rain';
        if (base === 'Snow') return 'Windy & Snow';
        return 'Windy';
      }

      return base;
    }

    async function fetchAbqWeather() {
      if (!wxStatusEl) return;

      const LAT = 35.0844;
      const LON = -106.6504;
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true&hourly=temperature_2m,weather_code,wind_speed_10m&timezone=America%2FDenver`;

      try {
        wxStatusEl.textContent = 'Loading current conditions…';
        const res = await fetch(url);
        if (!res.ok) throw new Error('Network error');
        const data = await res.json();

        // Current
        const current = data.current_weather;
        if (current) {
          const tempF = Math.round(cToF(current.temperature));
          const windMph = Math.round(kmhToMph(current.wind_speed_10m || current.windspeed || 0));
          const condLabel = mapWeatherCondition(current.weather_code ?? current.weathercode ?? 0, current.temperature, current.wind_speed_10m || current.windspeed || 0);

          wxTempEl.textContent = `${tempF}°F`;
          wxCondEl.textContent = condLabel;
          wxWindEl.textContent = `${windMph} mph`;
          wxStatusEl.textContent = '';
        } else {
          wxStatusEl.textContent = 'Current conditions unavailable.';
        }

        // Hourly next 8 hours
        if (wxHourlyEl && data.hourly && Array.isArray(data.hourly.time)) {
          wxHourlyEl.innerHTML = '';
          const times = data.hourly.time;
          const temps = data.hourly.temperature_2m || [];
          const codes = data.hourly.weather_code || data.hourly.weathercode || [];
          const winds = data.hourly.wind_speed_10m || data.hourly.windspeed_10m || [];

          const now = new Date();
          const upcoming = [];

          for (let i = 0; i < times.length; i++) {
            const t = new Date(times[i]);
            if (t <= now) continue;
            upcoming.push({ t, tempC: temps[i], code: codes[i], windKmh: winds[i] });
            if (upcoming.length >= 8) break;
          }

          upcoming.forEach(item => {
            const tempF = Math.round(cToF(item.tempC));
            const label = mapWeatherCondition(item.code, item.tempC, item.windKmh);
            const timeLabel = new Intl.DateTimeFormat('en-US', {
              hour: 'numeric',
              hour12: true
            }).format(item.t);

            const div = document.createElement('div');
            div.className = 'box';
            div.innerHTML = `<h3>${timeLabel}</h3>
              <div class="total">${tempF}°F</div>
              <div class="subhead" style="margin-top:4px">${label}</div>`;
            wxHourlyEl.appendChild(div);
          });

          // Following 8 hours (hours 9–16 ahead)
          const wxNext = document.getElementById('wx-hourly-next');
          if (wxNext) {
            let following = [];
            let startIndex = 0;

            // find the index right after our first 8 upcoming slots
            for (let i = 0; i < times.length; i++) {
              const t = new Date(times[i]);
              if (t > now) {
                startIndex = i + 8;
                break;
              }
            }

            for (let i = startIndex; i < times.length; i++) {
              const t = new Date(times[i]);
              following.push({
                t,
                tempC: temps[i],
                code: codes[i],
                windKmh: winds[i]
              });
              if (following.length >= 8) break;
            }

            wxNext.innerHTML = '';
            following.forEach(item => {
              const tempF2 = Math.round(cToF(item.tempC));
              const label2 = mapWeatherCondition(item.code, item.tempC, item.windKmh);
              const timeLabel2 = new Intl.DateTimeFormat('en-US', {
                hour: 'numeric',
                hour12: true
              }).format(item.t);

              const div2 = document.createElement('div');
              div2.className = 'box';
              div2.innerHTML = `<h3>${timeLabel2}</h3>
                <div class="total">${tempF2}°F</div>
                <div class="subhead" style="margin-top:4px">${label2}</div>`;
              wxNext.appendChild(div2);
            });
          }

          // Pets comfort: look at today's temps between 11:00 and 19:00
          const petsBox = document.getElementById('pets-box');
          const petsLabel = document.getElementById('pets-label');
          const petsText = document.getElementById('pets-text');
          if (petsBox && data.hourly && Array.isArray(data.hourly.time)) {
            const nowLocal = new Date();
            const todayY = nowLocal.getFullYear();
            const todayM = nowLocal.getMonth();
            const todayD = nowLocal.getDate();

            let totalSlots = 0;
            let coldSlots = 0;
            let warmSlots = 0;

            for (let i = 0; i < data.hourly.time.length; i++) {
              const t = new Date(data.hourly.time[i]);
              if (t.getFullYear() !== todayY || t.getMonth() !== todayM || t.getDate() !== todayD) continue;
              const hr = t.getHours();
              if (hr < 11 || hr > 19) continue;

              const tempC = (data.hourly.temperature_2m || [])[i];
              if (typeof tempC !== 'number') continue;
              const tempF = cToF(tempC);

              totalSlots++;
              if (tempF < 52) {
                coldSlots++;
              } else if (tempF >= 53) {
                warmSlots++;
              }
            }

            if (totalSlots === 0) {
              petsBox.classList.remove('pets-ok', 'pets-in');
              petsLabel.textContent = 'Pets status';
              petsText.textContent = "Today's daytime forecast not available.";
            } else if (coldSlots > warmSlots) {
              petsBox.classList.remove('pets-ok');
              petsBox.classList.add('pets-in');
              petsLabel.textContent = 'Pets Stay In';
              petsText.textContent = 'Below 52°F for most of 11 AM – 7 PM.';
            } else if (warmSlots > coldSlots) {
              petsBox.classList.remove('pets-in');
              petsBox.classList.add('pets-ok');
              petsLabel.textContent = 'Pets OK Out';
              petsText.textContent = '53°F or warmer for most of 11 AM – 7 PM.';
            } else {
              // Tie or mixed – be cautious
              petsBox.classList.remove('pets-ok');
              petsBox.classList.add('pets-in');
              petsLabel.textContent = 'Pets Stay In';
              petsText.textContent = 'Temperatures are mixed; keeping pets in is safer.';
            }
          }
        }
      } catch (err) {
        console.error(err);
        wxStatusEl.textContent = 'Weather data unavailable.';
      }
    }

    // Initial fetch + refresh every 10 minutes
    fetchAbqWeather();
    setInterval(fetchAbqWeather, 10 * 60 * 1000);

// ===== Mobile-fit helpers (added) =====
(function(){
  const content = document.getElementById('content');
  const tabbar = document.querySelector('.tabbar');
  const tabs = document.querySelector('.tabs');

  function adjustBottomPadding(){
    if (!content || !tabbar) return;
    const h = tabbar.offsetHeight || 90;
    // Add a little breathing room above the tabbar
    content.style.paddingBottom = (h + 24) + 'px';
  }

  function toggleCompactTabs(){
    if (!tabs) return;
    // Icons-only on very narrow screens for better fit
    if (window.innerWidth <= 400) {
      tabs.classList.add('compact');
    } else {
      tabs.classList.remove('compact');
    }
  }

  // Run on load and whenever layout might change
  window.addEventListener('load', () => { adjustBottomPadding(); toggleCompactTabs(); });
  window.addEventListener('resize', () => { adjustBottomPadding(); toggleCompactTabs(); });
  window.addEventListener('orientationchange', () => { setTimeout(()=>{ adjustBottomPadding(); toggleCompactTabs(); }, 150); });

  // Also re-run after the home overlay is dismissed since heights can change
  const home = document.getElementById('homeOverlay');
  if (home) {
    const obs = new MutationObserver(adjustBottomPadding);
    obs.observe(home, { attributes: true, attributeFilter: ['class'] });
  }
})();


// ===== Keep Enter button clear of bottom UI (added) =====
(function(){
  const root = document.documentElement;
  const content = document.getElementById('content');
  const tabbar = document.querySelector('.tabbar');
  const home = document.getElementById('homeOverlay');

  function getTabbarHeight(){
    return (tabbar && tabbar.offsetHeight) ? tabbar.offsetHeight : 90;
  }

  function adjustLayoutForBottomUI(){
    const h = getTabbarHeight();
    // Expose the tabbar height to CSS
    root.style.setProperty('--tabbar-h', h + 'px');

    // Make sure main content doesn't slip under the tabbar
    if (content) content.style.paddingBottom = (h + 24) + 'px';

    // Ensure the home overlay (with Enter button) has enough bottom padding
    if (home) {
      // If your overlay toggles classes like 'hidden' or 'open', padding still applies
      home.style.paddingBottom = (h + 24) + 'px';
    }
  }

  // Run on load and when layout changes
  window.addEventListener('load', adjustLayoutForBottomUI);
  window.addEventListener('resize', adjustLayoutForBottomUI);
  window.addEventListener('orientationchange', () => setTimeout(adjustLayoutForBottomUI, 150));

  // Observe home overlay visibility/class changes so padding updates when opened/closed
  if (home && 'MutationObserver' in window) {
    const obs = new MutationObserver(adjustLayoutForBottomUI);
    obs.observe(home, { attributes: true, attributeFilter: ['class', 'style'] });
  }

  // Small delay to catch late layout shifts (fonts/icons)
  setTimeout(adjustLayoutForBottomUI, 300);
})();

</script>
</body>
</html>
